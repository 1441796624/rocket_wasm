<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
  </head>

  <body>
    <h2>Rocket MVP</h2>
    <p>
      Update the state by 0.1 seconds by clicking the button below.
    </p>
    <button id="button">Click me :)</button>
    <p>Last state: <span id="number">none</span></p>

<!-- bundle.js is fully stolen from hellorust.org -->
<script src="bundle.js"></script>
<script>
  window.Module = {};

  fetch('program.wasm').then(response =>
    response.arrayBuffer()
    ).then(bytes =>
    WebAssembly.compile(bytes)
    ).then(function(mod) {
    var imports = WebAssembly.Module.imports(mod);
    imports.forEach(i => console.log(i));
    });

  let imports = {
    env: {
        Math_atan: Math.atan,
        sin: Math.sin,
        cos: Math.cos
    }
  };

  fetchAndInstantiate("program.wasm", imports)
    .then(mod => {
      Module.alloc = mod.exports.alloc;
      Module.dealloc = mod.exports.dealloc;
      Module.dealloc_str = mod.exports.dealloc_str;
      Module.update = mod.exports.update;
      Module.memory  = mod.exports.memory;

      let button = document.getElementById('button');
      let number = document.getElementById('number');

      button.addEventListener("click", function(e) {
        let outptr = Module.update(0.2);
        number.innerText = copyCStr(Module, outptr);
        Module.dealloc(outptr);
      });
    });
</script>
  </body>
</html>
